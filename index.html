<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Tableau Embed Playground | Misterdevs</title>
    <meta name="author" content="Misterdevs" />
    <meta
      name="description"
      content="Tableau Embed Playground. A simple web tool to generate JWT tokens using
      a Connected App secret and test embedding Tableau views or
      dashboards."
    />
    <meta
      name="keywords"
      content="tableau, tableau server, tableau cloud, tableau embed"
    />
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jsrsasign/10.8.6/jsrsasign-all-min.js"></script>
    <script
      type="module"
      src="https://public.tableau.com/javascripts/api/tableau.embedding.3.latest.min.js"
    ></script>
  </head>
  <body>
    <div>
      <div class="bg-white shadow-md p-5">
        <div class="grid grid-cols-1 gap-x-6 gap-y-8 sm:grid-cols-6">
          <div class="col-span-6">
            <h2 class="text-base/7 font-semibold text-gray-900">
              <span class="text-xl font-semibold">Tableau Embed</span>
              Playground
            </h2>
            <p class="mt-1 text-sm/6 text-gray-600">
              A simple web tool to generate JWT tokens using a Connected App
              secret and test embedding Tableau views or dashboards.
            </p>
          </div>
          <div id="optionRadio" class="col-span-6 flex space-x-6">
            <div class="flex items-center gap-x-3">
              <input
                id="generateToken"
                type="radio"
                name="option"
                onchange="checkSelected()"
                checked
                value="generateTokenForm"
                class="relative size-4 appearance-none rounded-full border border-gray-300 bg-white before:absolute before:inset-1 before:rounded-full before:bg-white not-checked:before:hidden checked:border-indigo-600 checked:bg-indigo-600 focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600 disabled:border-gray-300 disabled:bg-gray-100 disabled:before:bg-gray-400 forced-colors:appearance-auto forced-colors:before:hidden"
              />
              <label
                for="generateToken"
                class="block text-sm/6 font-medium text-gray-900"
                >Generate Token</label
              >
            </div>
            <div class="flex items-center gap-x-3">
              <input
                id="checkToken"
                type="radio"
                name="option"
                value="checkTokenForm"
                onchange="checkSelected()"
                class="relative size-4 appearance-none rounded-full border border-gray-300 bg-white before:absolute before:inset-1 before:rounded-full before:bg-white not-checked:before:hidden checked:border-indigo-600 checked:bg-indigo-600 focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600 disabled:border-gray-300 disabled:bg-gray-100 disabled:before:bg-gray-400 forced-colors:appearance-auto forced-colors:before:hidden"
              />
              <label
                for="checkToken"
                class="block text-sm/6 font-medium text-gray-900"
                >I have a Token</label
              >
            </div>
          </div>
        </div>
        <form id="generateTokenForm" class="fade-out">
          <div class="space-y-12">
            <div class="border-b border-gray-900/10 pb-12">
              <div
                class="mt-10 grid grid-cols-1 gap-x-6 gap-y-8 sm:grid-cols-6"
              >
                <div class="col-span-6 md:col-span-3 lg:col-span-2">
                  <label
                    for="tableau-user"
                    class="block text-sm/6 font-medium text-gray-900"
                    >Tableau User (sub)</label
                  >
                  <div class="mt-2">
                    <input
                      id="tableau-user"
                      type="text"
                      name="tableau-user"
                      autocomplete="username"
                      required
                      class="block w-full rounded-md bg-white px-3 py-1.5 text-base text-gray-900 outline-1 -outline-offset-1 outline-gray-300 placeholder:text-gray-400 focus:outline-2 focus:-outline-offset-2 focus:outline-indigo-600 sm:text-sm/6"
                    />
                  </div>
                  <p class="mt-3 text-xs/6 text-gray-400">
                    The Tableau user identity that the embedded content will run
                    as. This value is used as the sub claim in the JWT.
                  </p>
                </div>

                <div class="col-span-6 md:col-span-3 lg:col-span-2">
                  <label
                    for="client-id"
                    class="block text-sm/6 font-medium text-gray-900"
                    >Client ID (iss)</label
                  >
                  <div class="mt-2">
                    <input
                      id="client-id"
                      type="text"
                      name="client-id"
                      required
                      class="block w-full rounded-md bg-white px-3 py-1.5 text-base text-gray-900 outline-1 -outline-offset-1 outline-gray-300 placeholder:text-gray-400 focus:outline-2 focus:-outline-offset-2 focus:outline-indigo-600 sm:text-sm/6"
                    />
                  </div>
                  <p class="mt-3 text-xs/6 text-gray-400">
                    The unique identifier of the connected application. This is
                    used as the iss (issuer) claim in the JWT.
                  </p>
                </div>

                <div class="col-span-6 md:col-span-3 lg:col-span-2">
                  <label
                    for="secret-id"
                    class="block text-sm/6 font-medium text-gray-900"
                    >Secret ID (kid)</label
                  >
                  <div class="mt-2">
                    <input
                      id="secret-id"
                      type="text"
                      name="secret-id"
                      required
                      class="block w-full rounded-md bg-white px-3 py-1.5 text-base text-gray-900 outline-1 -outline-offset-1 outline-gray-300 placeholder:text-gray-400 focus:outline-2 focus:-outline-offset-2 focus:outline-indigo-600 sm:text-sm/6"
                    />
                  </div>
                  <p class="mt-3 text-xs/6 text-gray-400">
                    The identifier of the secret key used to sign the JWT. This
                    is placed in the JWT header as the kid.
                  </p>
                </div>

                <div class="col-span-6 md:col-span-3 lg:col-span-2">
                  <label
                    for="secret-value"
                    class="block text-sm/6 font-medium text-gray-900"
                    >Secret Value</label
                  >
                  <div class="mt-2">
                    <input
                      id="secret-value"
                      type="text"
                      name="secret-value"
                      required
                      class="block w-full rounded-md bg-white px-3 py-1.5 text-base text-gray-900 outline-1 -outline-offset-1 outline-gray-300 placeholder:text-gray-400 focus:outline-2 focus:-outline-offset-2 focus:outline-indigo-600 sm:text-sm/6"
                    />
                  </div>
                  <p class="mt-3 text-xs/6 text-gray-400">
                    The private secret string used to sign the JWT. Keep this
                    secure and never expose it publicly.
                  </p>
                </div>

                <div class="col-span-6 md:col-span-3 lg:col-span-2">
                  <label
                    for="scope"
                    class="block text-sm/6 font-medium text-gray-900"
                    >Scope (scp)</label
                  >
                  <div class="mt-2">
                    <input
                      id="scope"
                      type="text"
                      name="scope"
                      value="tableau:views:embed"
                      required
                      class="block w-full rounded-md bg-white px-3 py-1.5 text-base text-gray-900 outline-1 -outline-offset-1 outline-gray-300 placeholder:text-gray-400 focus:outline-2 focus:-outline-offset-2 focus:outline-indigo-600 sm:text-sm/6"
                    />
                  </div>
                  <p class="mt-3 text-xs/6 text-gray-400">
                    Determines what actions the embedded content is allowed to
                    perform. Multiple scopes are supported, separated by a comma
                    ( , ).
                  </p>
                </div>

                <div class="col-span-6 md:col-span-3 lg:col-span-2">
                  <label
                    for="embed-url"
                    class="block text-sm/6 font-medium text-gray-900"
                    >Embed URL</label
                  >
                  <div class="mt-2">
                    <input
                      id="embed-url"
                      type="text"
                      name="embed-url"
                      required
                      class="block w-full rounded-md bg-white px-3 py-1.5 text-base text-gray-900 outline-1 -outline-offset-1 outline-gray-300 placeholder:text-gray-400 focus:outline-2 focus:-outline-offset-2 focus:outline-indigo-600 sm:text-sm/6"
                    />
                  </div>
                  <p class="mt-3 text-xs/6 text-gray-400">
                    This should be the full URL to the view (from Tableau
                    Server, Cloud, or Public) that will be rendered in the
                    embedded frame.
                  </p>
                </div>
              </div>
            </div>

            <div
              id="tokenContainer"
              class="border-b border-gray-900/10 pb-12 hidden"
            >
              <label
                for="token"
                class="block text-sm/6 font-medium text-gray-900 pb-3"
                >JWT Token</label
              >
              <textarea
                id="token"
                rows="4"
                class="block w-full rounded-md bg-white px-3 py-1.5 text-base text-gray-900 outline-1 -outline-offset-1 outline-gray-300 placeholder:text-gray-400 focus:outline-2 focus:-outline-offset-2 focus:outline-indigo-600 sm:text-sm/6 hover:cursor-pointer"
                readonly
              ></textarea>
              <p class="mt-3 text-xs/6 text-gray-400">
                Click the token value to copy
              </p>
            </div>
          </div>

          <div class="mt-6 flex items-center justify-end gap-x-6">
            <button
              type="reset"
              class="text-sm/6 font-semibold text-gray-900 hover:cursor-pointer"
            >
              Reset
            </button>
            <button
              type="submit"
              class="rounded-md bg-indigo-600 px-3 py-2 text-sm font-semibold text-white shadow-xs hover:bg-indigo-500 focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600 hover:cursor-pointer"
            >
              Generate
            </button>
          </div>
        </form>
        <form id="checkTokenForm" class="fade-out hidden">
          <div class="space-y-12">
            <div class="border-b border-gray-900/10 pb-12">
              <div
                class="mt-10 grid grid-cols-1 gap-x-6 gap-y-8 sm:grid-cols-6"
              >
                <div class="col-span-6 md:col-span-3 lg:col-span-2">
                  <label
                    for="embed-url"
                    class="block text-sm/6 font-medium text-gray-900"
                    >Embed URL</label
                  >
                  <div class="mt-2">
                    <input
                      id="embed-url2"
                      type="text"
                      name="embed-url"
                      required
                      class="block w-full rounded-md bg-white px-3 py-1.5 text-base text-gray-900 outline-1 -outline-offset-1 outline-gray-300 placeholder:text-gray-400 focus:outline-2 focus:-outline-offset-2 focus:outline-indigo-600 sm:text-sm/6"
                    />
                  </div>
                  <p class="mt-3 text-xs/6 text-gray-400">
                    This should be the full URL to the view (from Tableau
                    Server, Cloud, or Public) that will be rendered in the
                    embedded frame.
                  </p>
                </div>
                <div id="tokenContainer" class="col-span-6">
                  <label
                    for="token"
                    class="block text-sm/6 font-medium text-gray-900 pb-3"
                    >JWT Token</label
                  >
                  <textarea
                    id="token2"
                    rows="4"
                    required
                    class="block w-full rounded-md bg-white px-3 py-1.5 text-base text-gray-900 outline-1 -outline-offset-1 outline-gray-300 placeholder:text-gray-400 focus:outline-2 focus:-outline-offset-2 focus:outline-indigo-600 sm:text-sm/6"
                  ></textarea>
                  <p class="mt-3 text-xs/6 text-gray-400">
                    Paste your JWT Token here.
                  </p>
                </div>
              </div>
            </div>
          </div>

          <div class="mt-6 flex items-center justify-end gap-x-6">
            <button type="reset" class="text-sm/6 font-semibold text-gray-900">
              Reset
            </button>
            <button
              type="submit"
              class="rounded-md bg-indigo-600 px-3 py-2 text-sm font-semibold text-white shadow-xs hover:bg-indigo-500 focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600"
            >
              Try Now
            </button>
          </div>
        </form>
        <div class="flex w-full justify-center items-center">
          <button
            class="bg-white border-1 border-gray-300 rounded-full p-1 shadow-xl -mb-10"
            onclick="toggleForm()"
          >
            <svg
              id="chev-up"
              xmlns="http://www.w3.org/2000/svg"
              fill="none"
              viewBox="0 0 24 24"
              stroke-width="1.5"
              stroke="currentColor"
              class="size-4"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                d="m4.5 18.75 7.5-7.5 7.5 7.5"
              />
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                d="m4.5 12.75 7.5-7.5 7.5 7.5"
              />
            </svg>
            <svg
              id="chev-down"
              xmlns="http://www.w3.org/2000/svg"
              fill="none"
              viewBox="0 0 24 24"
              stroke-width="1.5"
              stroke="currentColor"
              class="size-4 hidden"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                d="m4.5 5.25 7.5 7.5 7.5-7.5m-15 6 7.5 7.5 7.5-7.5"
              />
            </svg>
          </button>
        </div>
      </div>
      <div id="tableauVizContainer" class="w-full h-full p-5"></div>
    </div>
    <div
      class="fixed bottom-5 left-5 bg-white shadow-xl py-1 px-4 rounded-full border-[0.5px] border-gray-200 text-xs"
    >
      &copy;
      <a
        class="hover:text-indigo-500"
        href="https://github.com/misterdevs"
        target="_blank"
        >Misterdevs</a
      >
    </div>
  </body>
  <script>
    function toggleForm() {
      const selectedRadio = document.querySelector(
        'input[name="option"]:checked'
      );
      document.getElementById(selectedRadio.value).classList.toggle("hidden");
      document.getElementById("chev-up").classList.toggle("hidden");
      document.getElementById("chev-down").classList.toggle("hidden");
      document.getElementById("optionRadio").classList.toggle("hidden");
    }
    function checkSelected() {
      const selectedRadio = document.querySelector(
        'input[name="option"]:checked'
      );
      if (selectedRadio) {
        document.getElementById("generateTokenForm").classList.toggle("hidden");
        document.getElementById("checkTokenForm").classList.toggle("hidden");
      }
    }
    document.getElementById("token").onclick = function (e) {
      navigator.clipboard.writeText(e.target.value);
      alert("Token Copied!");
    };
    document.getElementById("generateTokenForm").onsubmit = function (e) {
      e.preventDefault();

      const tableauUser = document.getElementById("tableau-user").value;
      const clientId = document.getElementById("client-id").value;
      const secretId = document.getElementById("secret-id").value;
      const secretValue = document.getElementById("secret-value").value;
      const embedUrl = document.getElementById("embed-url").value;

      const scope = document
        .getElementById("scope")
        .value.split(",")
        .map((s) => s.trim());

      const token = generateToken(
        tableauUser,
        clientId,
        secretId,
        secretValue,
        scope
      );
      document.getElementById("tokenContainer").classList.remove("hidden");
      document.getElementById("token").value = token;

      generateEmbedTag(embedUrl, token);
      toggleForm();
    };

    document.getElementById("checkTokenForm").onsubmit = function (e) {
      e.preventDefault();

      const embedUrl = document.getElementById("embed-url2").value;
      const token = document.getElementById("token2").value;

      generateEmbedTag(embedUrl, token);
      toggleForm();
    };

    function generateEmbedTag(embedUrl, token) {
      const container = document.getElementById("tableauVizContainer");
      container.innerHTML = "";

      const viz = document.createElement("tableau-viz");
      viz.id = "tableau-viz";
      viz.src = embedUrl;
      viz.width = "1440";
      viz.height = "772";
      viz.toolbar = "bottom";
      viz.token = token;

      container.appendChild(viz);
    }

    function generateToken(sub, iss, kid, secret, scope) {
      const header = {
        alg: "HS256",
        typ: "JWT",
        kid: kid,
        iss: iss,
      };

      const payload = {
        iss: iss,
        sub: sub,
        aud: "tableau",
        jti: KJUR.crypto.Util.getRandomHexOfNbytes(16),
        iat: KJUR.jws.IntDate.get("now"),
        nbf: KJUR.jws.IntDate.get("now") - 5 * 60,
        exp: KJUR.jws.IntDate.get("now") + 5 * 60,
        scp: scope,
      };

      const sHeader = JSON.stringify(header);
      const sPayload = JSON.stringify(payload);
      const token = KJUR.jws.JWS.sign("HS256", sHeader, sPayload, secret);
      return token;
    }
  </script>
</html>
